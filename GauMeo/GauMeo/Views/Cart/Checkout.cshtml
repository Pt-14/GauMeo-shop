@model CheckoutViewModel

@{
    ViewBag.Title = "Thanh to√°n - GauMeo Petshop";
}

@section Styles {
    <link rel="stylesheet" href="/css/checkout.css">
}

<main>
    <div class="breadcrumb">
        <a href="/Home/Index" class="breadcrumb-link">Trang ch·ªß</a> /
        <a href="/Cart" class="breadcrumb-link">Gi·ªè h√†ng</a> /
        <span class="breadcrumb-link active">Thanh to√°n</span>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-error">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="checkout-container">
        <div class="checkout-header">
            <h1 class="checkout-title">Thanh to√°n</h1>
            <div class="checkout-steps">
                <div class="step active" id="step-1">
                    <span class="step-number">1</span>
                    <span class="step-text">Th√¥ng tin giao h√†ng</span>
                </div>
                <div class="step-divider"></div>
                <div class="step" id="step-2">
                    <span class="step-number">2</span>
                    <span class="step-text">Thanh to√°n</span>
                </div>
                <div class="step-divider"></div>
                <div class="step" id="step-3">
                    <span class="step-number">3</span>
                    <span class="step-text">Ho√†n th√†nh</span>
                </div>
            </div>
        </div>

        <div class="checkout-content">
            <!-- Ph·∫ßn b√™n tr√°i - Form -->
            <div class="checkout-left">
                <form asp-action="Checkout" method="post" id="checkout-form" class="delivery-form">
                    @Html.AntiForgeryToken()
                    
                    <!-- B∆∞·ªõc 1: Th√¥ng tin giao h√†ng -->
                    <div class="checkout-step-content" id="step-content-1">
                        <div class="delivery-info-section">
                            <h2 class="section-title">Th√¥ng tin giao h√†ng</h2>
                            
                            <div class="form-group">
                                <label asp-for="CustomerName">H·ªç v√† t√™n *</label>
                                <input asp-for="CustomerName" type="text" required placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n">
                                <span asp-validation-for="CustomerName" class="field-validation-error"></span>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label asp-for="CustomerEmail">Email</label>
                                    <input asp-for="CustomerEmail" type="email" placeholder="Nh·∫≠p email (kh√¥ng b·∫Øt bu·ªôc)">
                                    <span asp-validation-for="CustomerEmail" class="field-validation-error"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="CustomerPhone">S·ªë ƒëi·ªán tho·∫°i *</label>
                                    <input asp-for="CustomerPhone" type="tel" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                                    <span asp-validation-for="CustomerPhone" class="field-validation-error"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label asp-for="ShippingAddress">ƒê·ªãa ch·ªâ giao h√†ng *</label>
                                <textarea asp-for="ShippingAddress" rows="3" required placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng chi ti·∫øt (s·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, t·ªânh/th√†nh ph·ªë)"></textarea>
                                <span asp-validation-for="ShippingAddress" class="field-validation-error"></span>
                            </div>

                            <div class="form-group">
                                <label asp-for="BillingAddress">ƒê·ªãa ch·ªâ h√≥a ƒë∆°n (t√πy ch·ªçn)</label>
                                <textarea asp-for="BillingAddress" rows="2" placeholder="ƒê·ªÉ tr·ªëng n·∫øu tr√πng v·ªõi ƒë·ªãa ch·ªâ giao h√†ng"></textarea>
                            </div>

                            <div class="form-group">
                                <label asp-for="Notes">Ghi ch√∫ (t√πy ch·ªçn)</label>
                                <textarea asp-for="Notes" rows="3" placeholder="Ghi ch√∫ cho ƒë∆°n h√†ng..."></textarea>
                            </div>
                        </div>

                        <!-- Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn -->
                        <div class="shipping-section">
                            <h2 class="section-title">Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn</h2>
                            <div class="shipping-options">
                                <div class="shipping-option active" data-method="standard" data-price="30000">
                                    <div class="shipping-radio">
                                        <input type="radio" id="standard" name="shipping" value="standard" checked>
                                        <label for="standard"></label>
                                    </div>
                                    <div class="shipping-info">
                                        <div class="shipping-name">Giao h√†ng ti√™u chu·∫©n</div>
                                        <div class="shipping-desc">3-5 ng√†y l√†m vi·ªác</div>
                                    </div>
                                    <div class="shipping-price">
                                        @if (Model.SubTotal >= 700000)
                                        {
                                            <span class="free-shipping">Mi·ªÖn ph√≠</span>
                                        }
                                        else
                                        {
                                            <span>30.000ƒë</span>
                                        }
                                    </div>
                                </div>
                            </div>
                            
                            @if (Model.SubTotal >= 700000)
                            {
                                <div class="free-shipping-notice">
                                    <i class="icon-check"></i>
                                    <span>Ch√∫c m·ª´ng! B·∫°n ƒë∆∞·ª£c mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn cho ƒë∆°n h√†ng tr√™n 700.000ƒë</span>
                                </div>
                            }
                            else
                            {
                                var amountLeft = 700000 - Model.SubTotal;
                                <div class="shipping-promotion">
                                    <i class="icon-info"></i>
                                    <span>Mua th√™m @amountLeft.ToString("N0")ƒë ƒë·ªÉ ƒë∆∞·ª£c mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</span>
                                </div>
                            }
                        </div>

                        <!-- Button chuy·ªÉn b∆∞·ªõc -->
                        <div class="checkout-actions">
                            <button type="button" class="btn-continue-payment" id="btn-next-step">Ti·∫øp t·ª•c thanh to√°n</button>
                            <a href="/Cart" class="btn-back">‚Üê Quay l·∫°i gi·ªè h√†ng</a>
                        </div>
                    </div>

                    <!-- B∆∞·ªõc 2: Ph∆∞∆°ng th·ª©c thanh to√°n -->
                    <div class="checkout-step-content" id="step-content-2" style="display: none;">
                        <div class="delivery-info-section">
                            <h2 class="section-title">Ph∆∞∆°ng th·ª©c thanh to√°n</h2>
                            <div class="payment-methods">
                                <div class="payment-option active">
                                    <input type="radio" id="cod" name="PaymentMethod" value="COD" checked>
                                    <label for="cod" class="payment-label">
                                        <div class="payment-icon">üí∞</div>
                                        <div class="payment-info">
                                            <span class="payment-name">Thanh to√°n khi nh·∫≠n h√†ng (COD)</span>
                                            <span class="payment-desc">B·∫°n thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="payment-option">
                                    <input type="radio" id="bank" name="PaymentMethod" value="BankTransfer">
                                    <label for="bank" class="payment-label">
                                        <div class="payment-icon">üè¶</div>
                                        <div class="payment-info">
                                            <span class="payment-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
                                            <span class="payment-desc">Chuy·ªÉn kho·∫£n tr∆∞·ªõc khi giao h√†ng</span>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="payment-option">
                                    <input type="radio" id="ewallet" name="PaymentMethod" value="EWallet">
                                    <label for="ewallet" class="payment-label">
                                        <div class="payment-icon">üì±</div>
                                        <div class="payment-info">
                                            <span class="payment-name">V√≠ ƒëi·ªán t·ª≠</span>
                                            <span class="payment-desc">Thanh to√°n qua MoMo, ZaloPay</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Actions cho b∆∞·ªõc 2 -->
                        <div class="checkout-actions">
                            <button type="submit" class="btn-continue-payment">Ho√†n t·∫•t ƒë·∫∑t h√†ng</button>
                            <button type="button" class="btn-back" id="btn-prev-step">‚Üê Quay l·∫°i th√¥ng tin giao h√†ng</button>
                        </div>
                    </div>

                    <!-- Hidden fields -->
                    <input type="hidden" asp-for="SubTotal" />
                    <input type="hidden" asp-for="ShippingFee" />
                    <input type="hidden" asp-for="TotalAmount" />
                </form>

                <!-- Important Notice -->
                <div class="important-notice">
                    <h3 class="notice-title">L∆∞u √Ω quan tr·ªçng</h3>
                    <div class="notice-content">
                        <div class="notice-item">
                            <span class="notice-icon">!</span>
                            <span>Vui l√≤ng ki·ªÉm tra k·ªπ th√¥ng tin giao h√†ng tr∆∞·ªõc khi ƒë·∫∑t h√†ng</span>
                        </div>
                        <div class="notice-item">
                            <span class="notice-icon">!</span>
                            <span>ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n trong v√≤ng 24h k·ªÉ t·ª´ khi ƒë·∫∑t h√†ng</span>
                        </div>
                        <div class="notice-item">
                            <span class="notice-icon">!</span>
                            <span>Mi·ªÖn ph√≠ giao h√†ng cho ƒë∆°n h√†ng t·ª´ 700.000ƒë tr·ªü l√™n</span>
                        </div>
                        <div class="notice-item">
                            <span class="notice-icon">!</span>
                            <span>H·ªó tr·ª£ ƒë·ªïi tr·∫£ trong v√≤ng 7 ng√†y v·ªõi s·∫£n ph·∫©m ch∆∞a s·ª≠ d·ª•ng</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn b√™n ph·∫£i - T√≥m t·∫Øt ƒë∆°n h√†ng -->
            <div class="checkout-right">
                <div class="order-summary">
                    <h2 class="section-title">T√≥m t·∫Øt ƒë∆°n h√†ng</h2>
                    
                    <!-- Danh s√°ch s·∫£n ph·∫©m -->
                    <div class="order-items">
                        @foreach (var item in Model.CartItems)
                        {
                            <div class="order-item">
                                <div class="order-item-image">
                                    <img src="@(item.Product.ProductImages?.FirstOrDefault()?.ImageUrl ?? "/images/products/default-product.jpg")" alt="@item.Product.Name">
                                </div>
                                <div class="order-item-info">
                                    <h4 class="order-item-name">@item.Product.Name</h4>
                                    @if (!string.IsNullOrEmpty(item.SelectedVariants))
                                    {
                                        var variants = item.GetSelectedVariants();
                                        @if (variants.Any())
                                        {
                                            <div class="order-item-details">
                                                @foreach (var variant in variants)
                                                {
                                                    <span class="variant-tag">@variant.Key: @variant.Value</span>
                                                }
                                            </div>
                                        }
                                    }
                                    <div class="order-item-price">
                                        <span class="order-item-quantity">SL: @item.Quantity</span>
                                        <span class="order-item-total">@item.GetSubTotal().ToString("N0")ƒë</span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- T√≥m t·∫Øt gi√° -->
                    <div class="price-summary">
                        <div class="price-row">
                            <span>T·∫°m t√≠nh (@Model.CartItems.Count() s·∫£n ph·∫©m)</span>
                            <span id="subtotal">@Model.SubTotal.ToString("N0")ƒë</span>
                        </div>
                        <div class="price-row">
                            <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                            <span id="shipping-fee">
                                @if (Model.ShippingFee > 0)
                                {
                                    @Model.ShippingFee.ToString("N0")<text>ƒë</text>
                                }
                                else
                                {
                                    <span class="free-text">Mi·ªÖn ph√≠</span>
                                }
                            </span>
                        </div>
                        <div class="checkout-price-divider"></div>
                        <div class="price-row total-row">
                            <span>T·ªïng c·ªông</span>
                            <span id="total-amount">@Model.TotalAmount.ToString("N0")ƒë</span>
                        </div>
                    </div>

                    <!-- Th√¥ng tin li√™n h·ªá -->
                    <div class="contact-info">
                        <div class="contact-item">
                            <span class="contact-icon">üìû</span>
                            <span>Hotline: 1900 1234</span>
                        </div>
                        <div class="contact-item">
                            <span class="contact-icon">‚úâÔ∏è</span>
                            <span>Email: support@gaumeo.com</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script src="~/js/cart-checkout.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
} 