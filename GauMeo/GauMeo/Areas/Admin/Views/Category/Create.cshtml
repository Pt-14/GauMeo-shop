@model GauMeo.Models.Categories.Category
@{
    ViewData["Title"] = "Th√™m danh m·ª•c m·ªõi";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="main-content">
    <div class="admin-card">
        <div class="card-header-admin">
            <div class="header-left">
                <h4 class="card-title">
                    <i class='bx bx-plus'></i>
                    Th√™m danh m·ª•c m·ªõi
                </h4>
                <p class="card-subtitle">T·∫°o danh m·ª•c m·ªõi cho s·∫£n ph·∫©m</p>
            </div>
            <div class="header-actions">
                <a href="@Url.Action("Index")" class="btn-admin btn-secondary">
                    <i class='bx bx-arrow-back'></i>
                    Quay l·∫°i
                </a>
            </div>
        </div>

        <form asp-action="Create" method="post" class="admin-form">
            <div asp-validation-summary="ModelOnly" class="validation-summary"></div>

            <div class="form-grid">
                <!-- Th√¥ng tin c∆° b·∫£n -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class='bx bx-info-circle'></i>
                        Th√¥ng tin c∆° b·∫£n
                    </h5>

                    <div class="form-group">
                        <label asp-for="Name" class="form-label required">T√™n danh m·ª•c</label>
                        <input asp-for="Name" class="form-control" placeholder="Nh·∫≠p t√™n danh m·ª•c..." />
                        <span asp-validation-for="Name" class="field-validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Slug" class="form-label">Slug (URL th√¢n thi·ªán)</label>
                        <div class="input-group">
                            <input asp-for="Slug" class="form-control" placeholder="Slug s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông..." />
                            <button type="button" id="generateSlugBtn" class="btn-admin btn-outline">
                                <i class='bx bx-refresh'></i>
                                T·∫°o t·ª± ƒë·ªông
                            </button>
                        </div>
                        <span asp-validation-for="Slug" class="field-validation-error"></span>
                        <small class="form-text">N·∫øu ƒë·ªÉ tr·ªëng, slug s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ t√™n danh m·ª•c</small>
                    </div>

                    <div class="form-group">
                        <label asp-for="Description" class="form-label">M√¥ t·∫£</label>
                        <textarea asp-for="Description" class="form-control" rows="4" placeholder="Nh·∫≠p m√¥ t·∫£ cho danh m·ª•c..."></textarea>
                        <span asp-validation-for="Description" class="field-validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Icon" class="form-label">Icon (Emoji)</label>
                        <input asp-for="Icon" class="form-control" placeholder="ü•£" maxlength="2" />
                        <span asp-validation-for="Icon" class="field-validation-error"></span>
                        <small class="form-text">Emoji ƒë·∫°i di·ªán cho danh m·ª•c (v√≠ d·ª•: ü•£, ü•´, ü¶¥)</small>
                    </div>
                </div>

                <!-- C·∫•u tr√∫c ph√¢n c·∫•p -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class='bx bx-sitemap'></i>
                        C·∫•u tr√∫c ph√¢n c·∫•p
                    </h5>

                    <div class="form-group">
                        <label asp-for="Level" class="form-label required">C·∫•p ƒë·ªô</label>
                        <select asp-for="Level" class="form-control" id="levelSelect">
                            <option value="">-- Ch·ªçn c·∫•p ƒë·ªô --</option>
                            <option value="1">C·∫•p 1 - Danh m·ª•c ch√≠nh (Ch√≥, M√®o)</option>
                            <option value="2">C·∫•p 2 - Danh m·ª•c cha (Th·ª©c ƒÉn, ƒê·ªì ch∆°i)</option>
                            <option value="3">C·∫•p 3 - Danh m·ª•c con (Th·ª©c ƒÉn h·∫°t, B√°nh th∆∞·ªüng)</option>
                        </select>
                        <span asp-validation-for="Level" class="field-validation-error"></span>
                    </div>

                    <div class="form-group" id="animalTypeGroup">
                        <label asp-for="AnimalType" class="form-label">Lo·∫°i th√∫ c∆∞ng</label>
                        <select asp-for="AnimalType" class="form-control">
                            <option value="">-- Ch·ªçn lo·∫°i th√∫ c∆∞ng --</option>
                            <option value="dog">Ch√≥</option>
                            <option value="cat">M√®o</option>
                            <option value="both">C·∫£ hai</option>
                        </select>
                        <span asp-validation-for="AnimalType" class="field-validation-error"></span>
                        <small class="form-text">Ch·ªâ √°p d·ª•ng cho danh m·ª•c c·∫•p 1</small>
                    </div>

                    <div class="form-group" id="parentCategoryGroup" style="display: none;">
                        <label asp-for="ParentCategoryId" class="form-label">Danh m·ª•c cha</label>
                        <select asp-for="ParentCategoryId" class="form-control">
                            <option value="">-- Ch·ªçn danh m·ª•c cha --</option>
                            @if (ViewBag.ParentCategories != null)
                            {
                                @foreach (var parent in (IEnumerable<GauMeo.Models.Categories.Category>)ViewBag.ParentCategories)
                                {
                                    <option value="@parent.Id">
                                        @(string.IsNullOrEmpty(parent.AnimalType) ? "" : $"[{(parent.AnimalType == "dog" ? "Ch√≥" : parent.AnimalType == "cat" ? "M√®o" : "C·∫£ hai")}] ")@parent.Name
                                    </option>
                                }
                            }
                        </select>
                        <span asp-validation-for="ParentCategoryId" class="field-validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="DisplayOrder" class="form-label">Th·ª© t·ª± hi·ªÉn th·ªã</label>
                        <input asp-for="DisplayOrder" type="number" class="form-control" value="0" min="0" />
                        <span asp-validation-for="DisplayOrder" class="field-validation-error"></span>
                        <small class="form-text">S·ªë th·ª© t·ª± hi·ªÉn th·ªã (nh·ªè h∆°n = hi·ªÉn th·ªã tr∆∞·ªõc)</small>
                    </div>
                </div>

                <!-- H√¨nh ·∫£nh v√† hi·ªÉn th·ªã -->
                <div class="form-section">
                    <h5 class="section-title">
                        <i class='bx bx-image'></i>
                        H√¨nh ·∫£nh v√† hi·ªÉn th·ªã
                    </h5>

                    <div class="form-group">
                        <label asp-for="ImageUrl" class="form-label">URL h√¨nh ·∫£nh</label>
                        <input asp-for="ImageUrl" class="form-control" placeholder="https://example.com/image.jpg" />
                        <span asp-validation-for="ImageUrl" class="field-validation-error"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="IconUrl" class="form-label">URL icon</label>
                        <input asp-for="IconUrl" class="form-control" placeholder="https://example.com/icon.svg" />
                        <span asp-validation-for="IconUrl" class="field-validation-error"></span>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <div class="form-check">
                                <input asp-for="IsActive" type="checkbox" class="form-check-input" checked />
                                <label asp-for="IsActive" class="form-check-label">K√≠ch ho·∫°t</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="IsShowOnHome" type="checkbox" class="form-check-input" />
                                <label asp-for="IsShowOnHome" class="form-check-label">Hi·ªÉn th·ªã tr√™n trang ch·ªß</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-admin btn-success">
                    <i class='bx bx-save'></i>
                    L∆∞u danh m·ª•c
                </button>
                <a href="@Url.Action("Index")" class="btn-admin btn-secondary">
                    <i class='bx bx-x'></i>
                    H·ªßy
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Handle level selection
            $('#levelSelect').change(function() {
                var level = $(this).val();
                var animalTypeGroup = $('#animalTypeGroup');
                var parentCategoryGroup = $('#parentCategoryGroup');
                
                if (level == '1') {
                    animalTypeGroup.show();
                    parentCategoryGroup.hide();
                    $('#ParentCategoryId').val('');
                } else if (level == '2' || level == '3') {
                    animalTypeGroup.hide();
                    parentCategoryGroup.show();
                    $('#AnimalType').val('');
                } else {
                    animalTypeGroup.hide();
                    parentCategoryGroup.hide();
                }
            });

            // Auto-generate slug from name
            $('#Name').on('input', function() {
                if ($('#Slug').val() === '') {
                    generateSlugFromName();
                }
            });

            // Manual slug generation
            $('#generateSlugBtn').click(function() {
                generateSlugFromName();
            });

            function generateSlugFromName() {
                var name = $('#Name').val();
                if (name) {
                    $.ajax({
                        url: '@Url.Action("GenerateSlug")',
                        method: 'POST',
                        data: JSON.stringify(name),
                        contentType: 'application/json',
                        success: function(response) {
                            if (response.success) {
                                $('#Slug').val(response.slug);
                            }
                        }
                    });
                }
            }

            // Check slug uniqueness
            $('#Slug').on('blur', function() {
                var slug = $(this).val();
                if (slug) {
                    $.ajax({
                        url: '@Url.Action("CheckSlug")',
                        method: 'POST',
                        data: JSON.stringify({ slug: slug, excludeId: null }),
                        contentType: 'application/json',
                        success: function(response) {
                            if (!response.isUnique) {
                                alert('Slug n√†y ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. Vui l√≤ng ch·ªçn slug kh√°c.');
                                $('#Slug').focus();
                            }
                        }
                    });
                }
            });

            // Initialize on page load
            $('#levelSelect').trigger('change');
        });
    </script>
} 