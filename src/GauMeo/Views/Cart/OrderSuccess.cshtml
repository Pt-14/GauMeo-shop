@model Order

@{
    ViewBag.Title = "ƒê·∫∑t h√†ng th√†nh c√¥ng - GauMeo Petshop";
}

@section Styles {
    <link rel="stylesheet" href="/css/order-success.css">
}

<main>
    @await Html.PartialAsync("_Breadcrumb", Url.CreateBreadcrumb(
        ("Trang ch·ªß", "Index", "Home"),
        ("Gi·ªè h√†ng", "Index", "Cart"),
        ("Thanh to√°n", "Checkout", "Cart"),
        ("ƒê·∫∑t h√†ng th√†nh c√¥ng", null, null)
    ))

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    <div class="order-success-container">
        <!-- Success Icon -->
        <div class="success-icon">
            <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22,4 12,14.01 9,11.01"></polyline>
            </svg>
        </div>

        <!-- Success Message -->
        <div class="success-message">
            <h1 class="success-title">ƒê·∫∑t h√†ng th√†nh c√¥ng!</h1>
            <p class="success-subtitle">C·∫£m ∆°n b·∫°n ƒë√£ tin t∆∞·ªüng GauMeo Petshop</p>
        </div>

        <!-- Order Information -->
        <div class="order-info">
            <div class="order-number">
                <span class="label">M√£ ƒë∆°n h√†ng:</span>
                <span class="value">@Model.OrderNumber</span>
            </div>
            
            <div class="order-details">
                <div class="detail-row">
                    <span class="label">Th·ªùi gian ƒë·∫∑t:</span>
                    <span class="value">@Model.CreatedAt.ToString("dd/MM/yyyy - HH:mm")</span>
                </div>
                <div class="detail-row">
                    <span class="label">T·∫°m t√≠nh:</span>
                    <span class="value">@((Model.TotalAmount - Model.ShippingFee).ToString("N0")) ƒë</span>
                </div>
                <div class="detail-row">
                    <span class="label">Ph√≠ v·∫≠n chuy·ªÉn:</span>
                    <span class="value">
                        @if (Model.ShippingFee > 0)
                        {
                            @Model.ShippingFee.ToString("N0")<text> ƒë</text>
                        }
                        else
                        {
                            <span class="free-shipping-text">Mi·ªÖn ph√≠</span>
                        }
                    </span>
                </div>
                <div class="detail-row total-row">
                    <span class="label">T·ªïng ti·ªÅn:</span>
                    <span class="value price">@Model.TotalAmount.ToString("N0") ƒë</span>
                </div>
                <div class="detail-row">
                    <span class="label">Ph∆∞∆°ng th·ª©c thanh to√°n:</span>
                    <span class="value">
                        @switch (Model.PaymentMethod)
                        {
                            case "COD":
                                @:Thanh to√°n khi nh·∫≠n h√†ng
                                break;
                            case "BankTransfer":
                                @:Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                                break;
                            case "EWallet":
                                @:V√≠ ƒëi·ªán t·ª≠
                                break;
                            default:
                                @Model.PaymentMethod
                                break;
                        }
                    </span>
                </div>
                <div class="detail-row">
                    <span class="label">Tr·∫°ng th√°i:</span>
                    <span class="value status">
                        @switch (Model.Status)
                        {
                            case "Pending":
                                @:ƒêang ch·ªù x·ª≠ l√Ω
                                break;
                            case "Confirmed":
                                @:ƒê√£ x√°c nh·∫≠n
                                break;
                            case "Processing":
                                @:ƒêang x·ª≠ l√Ω
                                break;
                            case "Shipping":
                                @:ƒêang giao h√†ng
                                break;
                            case "Delivered":
                                @:ƒê√£ giao h√†ng
                                break;
                            case "Cancelled":
                                @:ƒê√£ h·ªßy
                                break;
                            default:
                                @Model.Status
                                break;
                        }
                    </span>
                </div>
            </div>
        </div>

        <!-- Order Items Summary -->
        <div class="order-items-summary">
            <h2 class="items-title">S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t (@Model.OrderItems.Count s·∫£n ph·∫©m)</h2>
            <div class="items-list">
                @foreach (var item in Model.OrderItems)
                {
                    <div class="order-item">
                        <div class="item-image">
                            <img src="@item.ProductImageUrl" alt="@item.ProductName">
                        </div>
                        <div class="item-details">
                            <h4 class="item-name">@item.ProductName</h4>
                            @if (!string.IsNullOrEmpty(item.SelectedVariants))
                            {
                                var variants = item.GetSelectedVariants();
                                @if (variants.Any())
                                {
                                    <div class="item-variants">
                                        @foreach (var variant in variants)
                                        {
                                            <span class="variant-tag">@variant.Key: @variant.Value</span>
                                        }
                                    </div>
                                }
                            }
                            <div class="item-quantity">S·ªë l∆∞·ª£ng: @item.Quantity</div>
                        </div>
                        <div class="item-price">
                            @item.SubTotal.ToString("N0") ƒë
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Customer Information -->
        <div class="customer-info">
            <h2 class="info-title">Th√¥ng tin giao h√†ng</h2>
            <div class="info-details">
                <div class="info-row">
                    <span class="info-label">Ng∆∞·ªùi nh·∫≠n:</span>
                    <span class="info-value">@Model.CustomerName</span>
                </div>
                <div class="info-row">
                    <span class="info-label">S·ªë ƒëi·ªán tho·∫°i:</span>
                    <span class="info-value">@Model.CustomerPhone</span>
                </div>
                @if (!string.IsNullOrEmpty(Model.CustomerEmail))
                {
                    <div class="info-row">
                        <span class="info-label">Email:</span>
                        <span class="info-value">@Model.CustomerEmail</span>
                    </div>
                }
                <div class="info-row">
                    <span class="info-label">ƒê·ªãa ch·ªâ giao h√†ng:</span>
                    <span class="info-value">@Model.ShippingAddress</span>
                </div>
                @if (!string.IsNullOrEmpty(Model.Notes))
                {
                    <div class="info-row">
                        <span class="info-label">Ghi ch√∫:</span>
                        <span class="info-value">@Model.Notes</span>
                    </div>
                }
            </div>
        </div>

        <!-- Next Steps -->
        <div class="next-steps">
            <h2 class="steps-title">Th√¥ng tin quan tr·ªçng</h2>
            <div class="steps-content">
                <div class="step-item">
                    <div class="step-icon">üìû</div>
                    <div class="step-text">
                        <strong>X√°c nh·∫≠n ƒë∆°n h√†ng:</strong> Ch√∫ng t√¥i s·∫Ω li√™n h·ªá v·ªõi b·∫°n trong v√≤ng 2-4 gi·ªù ƒë·ªÉ x√°c nh·∫≠n ƒë∆°n h√†ng
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-icon">üì¶</div>
                    <div class="step-text">
                        <strong>Chu·∫©n b·ªã h√†ng:</strong> ƒê∆°n h√†ng s·∫Ω ƒë∆∞·ª£c chu·∫©n b·ªã v√† ƒë√≥ng g√≥i trong 1-2 ng√†y l√†m vi·ªác
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-icon">üöö</div>
                    <div class="step-text">
                        <strong>Giao h√†ng:</strong> Th·ªùi gian giao h√†ng d·ª± ki·∫øn t·ª´ 2-5 ng√†y l√†m vi·ªác t√πy theo khu v·ª±c
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-icon">üì±</div>
                    <div class="step-text">
                        <strong>Theo d√µi ƒë∆°n h√†ng:</strong> B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c SMS/Email th√¥ng b√°o khi ƒë∆°n h√†ng thay ƒë·ªïi tr·∫°ng th√°i
                    </div>
                </div>
            </div>
        </div>

        <!-- Support Information -->
        <div class="support-info">
            <h3 class="support-title">C·∫ßn h·ªó tr·ª£?</h3>
            <div class="support-content">
                <div class="support-item">
                    <span class="support-icon">üìû</span>
                    <span>Hotline: <strong>1900 1234</strong> (8:00 - 22:00)</span>
                </div>
                <div class="support-item">
                    <span class="support-icon">‚úâÔ∏è</span>
                    <span>Email: <strong>support@gaumeo.com</strong></span>
                </div>
                <div class="support-item">
                    <span class="support-icon">üí¨</span>
                    <span>Live Chat tr√™n website (8:00 - 22:00)</span>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="/Home/Index" class="btn btn-primary">Ti·∫øp t·ª•c mua s·∫Øm</a>
            @if (User.Identity?.IsAuthenticated == true)
            {
                <a href="/Account/Profile#order-history" class="btn btn-outline">Xem ƒë∆°n h√†ng c·ªßa t√¥i</a>
            }
        </div>

        <!-- Share Section -->
        <div class="share-section">
            <p class="share-text">Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªõi GauMeo</p>
            <div class="share-buttons">
                <a href="#" class="share-btn facebook">
                    <span class="share-icon">üìò</span>
                    Facebook
                </a>
                <a href="#" class="share-btn instagram">
                    <span class="share-icon">üì∑</span>
                    Instagram
                </a>
                <a href="#" class="share-btn review">
                    <span class="share-icon">‚≠ê</span>
                    ƒê√°nh gi√°
                </a>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <script>
        // Pass order data from server to JavaScript
        window.orderData = {
            id: @Model.Id,
            orderNumber: '@Model.OrderNumber',
            customerName: '@Model.CustomerName',
            customerPhone: '@Model.CustomerPhone',
            customerEmail: '@(Model.CustomerEmail ?? "")',
            shippingAddress: '@Html.Raw(Html.Encode(Model.ShippingAddress).ToString().Replace("'", "\\'"))',
            paymentMethod: '@Model.PaymentMethod',
            status: '@Model.Status',
            totalAmount: @Model.TotalAmount,
            shippingFee: @Model.ShippingFee,
            createdAt: '@Model.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")',
            notes: '@Html.Raw(Html.Encode(Model.Notes ?? "").ToString().Replace("'", "\\'"))',
            orderItems: [
                @foreach (var item in Model.OrderItems)
                {
                    <text>{
                        id: @item.Id,
                        productName: '@Html.Raw(Html.Encode(item.ProductName).ToString().Replace("'", "\\'"))',
                        productBrand: '@Html.Raw(Html.Encode(item.ProductBrand ?? "").ToString().Replace("'", "\\'"))',
                        productImageUrl: '@item.ProductImageUrl',
                        quantity: @item.Quantity,
                        unitPrice: @item.UnitPrice,
                        subTotal: @item.SubTotal,
                        selectedVariants: '@Html.Raw(Html.Encode(item.SelectedVariants ?? "").ToString().Replace("'", "\\'"))'
                    }</text>
                    @if (item != Model.OrderItems.Last())
                    {
                        <text>,</text>
                    }
                }
            ]
        };
    </script>
    <script src="~/js/cart-checkout.js" asp-append-version="true"></script>
} 