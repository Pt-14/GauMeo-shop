@model GauMeo.Models.Categories.Brand
@{
    ViewData["Title"] = $"Xóa thương hiệu: {Model.Name}";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="main-content">
    <div class="admin-card">
        <div class="card-header-admin">
            <h4 class="card-title text-danger">
                <i class='bx bx-warning'></i>
                @ViewData["Title"]
            </h4>
        </div>

        <div class="alert alert-danger">
            <h5><i class='bx bx-error-circle'></i> Cảnh báo</h5>
            <p>Bạn có chắc chắn muốn xóa thương hiệu này? <strong>Thao tác này không thể hoàn tác.</strong></p>
            @if (Model.Products != null && Model.Products.Any())
            {
                <p class="mb-0">
                    <strong>Lưu ý:</strong> Thương hiệu này hiện có <strong>@Model.Products.Count() sản phẩm</strong> liên kết. 
                    Việc xóa có thể ảnh hưởng đến dữ liệu sản phẩm.
                </p>
            }
        </div>

        <div class="delete-content">
            <div class="row">
                <div class="col-md-4">
                    <div class="brand-logo-delete">
                        @if (!string.IsNullOrEmpty(Model.Image))
                        {
                            <img src="@Model.Image" alt="@Model.Name" class="brand-logo-medium" />
                        }
                        else
                        {
                            <div class="no-logo-medium">
                                <i class='bx bx-category-alt'></i>
                                <span>Không có logo</span>
                            </div>
                        }
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="brand-info-delete">
                        <h5>Thông tin thương hiệu sẽ bị xóa:</h5>
                        
                        <div class="info-list">
                            <div class="info-row">
                                <label>Tên thương hiệu:</label>
                                <span>@Model.Name</span>
                            </div>
                            <div class="info-row">
                                <label>Tên viết tắt:</label>
                                <span>@(Model.ShortName ?? "Chưa có")</span>
                            </div>
                            <div class="info-row">
                                <label>Mô tả:</label>
                                <span>@(string.IsNullOrEmpty(Model.Description) ? "Chưa có" : 
                                        (Model.Description.Length > 100 ? Model.Description.Substring(0, 100) + "..." : Model.Description))</span>
                            </div>
                            <div class="info-row">
                                <label>Trạng thái:</label>
                                <span class="status-badge @(Model.IsActive ? "active" : "inactive")">
                                    @(Model.IsActive ? "Đang hoạt động" : "Ngừng hoạt động")
                                </span>
                            </div>
                            <div class="info-row">
                                <label>Ngày tạo:</label>
                                <span>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
                            </div>
                            @if (Model.Products != null)
                            {
                                <div class="info-row">
                                    <label>Số sản phẩm liên kết:</label>
                                    <span class="text-warning">
                                        <strong>@Model.Products.Count() sản phẩm</strong>
                                    </span>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @if (Model.Products != null && Model.Products.Any())
        {
            <div class="affected-products mt-4">
                <h6 class="text-warning">
                    <i class='bx bx-package'></i>
                    Sản phẩm sẽ bị ảnh hưởng:
                </h6>
                <div class="products-list">
                    @foreach (var product in Model.Products.Take(5))
                    {
                        <div class="affected-product">
                            <div class="product-image-small">
                                @if (product.ProductImages != null && product.ProductImages.Any())
                                {
                                    <img src="@product.ProductImages.First().ImageUrl" alt="@product.Name" />
                                }
                                else
                                {
                                    <div class="no-image-small">
                                        <i class='bx bx-package'></i>
                                    </div>
                                }
                            </div>
                            <div class="product-details">
                                <span class="product-name">@product.Name</span>
                                <span class="product-price">@((product.OriginalPrice * (100 - product.DiscountPercent) / 100).ToString("N0")) VNĐ</span>
                                <span class="status-badge-small @(product.IsActive ? "active" : "inactive")">
                                    @(product.IsActive ? "Hoạt động" : "Ngừng")
                                </span>
                            </div>
                        </div>
                    }
                    @if (Model.Products.Count() > 5)
                    {
                        <div class="more-affected">
                            <span>+@(Model.Products.Count() - 5) sản phẩm khác...</span>
                        </div>
                    }
                </div>
            </div>
        }

        <div class="form-actions-delete">
            <form asp-action="Delete" method="post" style="display: inline;">
                <input asp-for="Id" type="hidden" />
                <button type="submit" class="btn-admin btn-danger" onclick="return confirmDelete()">
                    <i class='bx bx-trash'></i>
                    Xác nhận xóa
                </button>
            </form>
            
            <a href="@Url.Action("Details", new { id = Model.Id })" class="btn-admin btn-info">
                <i class='bx bx-show'></i>
                Xem chi tiết
            </a>
            
            <a href="@Url.Action("Edit", new { id = Model.Id })" class="btn-admin btn-warning">
                <i class='bx bx-edit'></i>
                Chỉnh sửa thay thế
            </a>
            
            <a href="@Url.Action("Index")" class="btn-admin btn-secondary">
                <i class='bx bx-arrow-back'></i>
                Quay lại danh sách
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmDelete() {
            const hasProducts = @(Model.Products != null && Model.Products.Any() ? "true" : "false");
            
            if (hasProducts) {
                return confirm(
                    'CẢNH BÁO: Thương hiệu này có sản phẩm liên kết!\n\n' +
                    'Việc xóa có thể ảnh hưởng đến @Model.Products?.Count() sản phẩm.\n' +
                    'Bạn có chắc chắn muốn tiếp tục?\n\n' +
                    'Thao tác này KHÔNG THỂ HOÀN TÁC!'
                );
            } else {
                return confirm(
                    'Bạn có chắc chắn muốn xóa thương hiệu "@Model.Name"?\n\n' +
                    'Thao tác này KHÔNG THỂ HOÀN TÁC!'
                );
            }
        }
    </script>
}

<style>
    .brand-logo-delete {
        text-align: center;
        margin-bottom: 20px;
    }

    .brand-logo-medium {
        max-width: 150px;
        max-height: 150px;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        opacity: 0.7;
    }

    .no-logo-medium {
        width: 150px;
        height: 150px;
        border: 2px dashed #ddd;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #999;
        margin: 0 auto;
        opacity: 0.7;
    }

    .no-logo-medium i {
        font-size: 36px;
        margin-bottom: 8px;
    }

    .brand-info-delete h5 {
        color: #e74c3c;
        margin-bottom: 15px;
    }

    .info-list {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-row label {
        font-weight: bold;
        color: #555;
        min-width: 140px;
    }

    .info-row span {
        color: #333;
        text-align: right;
        flex: 1;
    }

    .affected-products {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
    }

    .affected-products h6 {
        margin-bottom: 15px;
        color: #856404;
    }

    .products-list {
        max-height: 200px;
        overflow-y: auto;
    }

    .affected-product {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        margin-bottom: 8px;
    }

    .product-image-small {
        width: 40px;
        height: 40px;
        overflow: hidden;
        border-radius: 4px;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .product-image-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .no-image-small {
        color: #999;
        font-size: 16px;
    }

    .product-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .product-name {
        font-weight: bold;
        font-size: 14px;
        color: #333;
    }

    .product-price {
        font-size: 12px;
        color: #e74c3c;
        font-weight: bold;
    }

    .status-badge-small {
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 10px;
        display: inline-block;
        width: fit-content;
    }

    .status-badge-small.active {
        background: #d4edda;
        color: #155724;
    }

    .status-badge-small.inactive {
        background: #f8d7da;
        color: #721c24;
    }

    .more-affected {
        text-align: center;
        color: #856404;
        font-style: italic;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
    }

    .form-actions-delete {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #e9ecef;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .form-actions-delete .btn-admin {
        min-width: 150px;
    }
</style> 